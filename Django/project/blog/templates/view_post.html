{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Post</title>

   <!-- font awesome cdn link  -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
   <link rel="icon" type="image/x-icon" href="{% static 'image/doraemon.webp' %}">
   <!-- custom css file link  -->
   <link rel="stylesheet" href="{% static 'css/style.css' %}">

</head>
<body>
   
{% include 'user_header.html' %}

   {% if comment_id %}
   <section class="comment-edit-form">
   <p>Edit your comment</p>
   <form action="" method="POST">
      {% csrf_token %}
      <input type="hidden" name="edit_comment_id" value="{{ comment_id }}">
      <textarea name="comment_edit_box" required cols="30" rows="10" placeholder="Please enter your comment">{{ edit_comment.comment }}</textarea>
      <button type="submit" class="inline-btn" name="edit_comment">Edit comment</button>
      <div class="inline-option-btn" onclick="window.location.href = '{% url 'view_post' post.id %}';">Cancel</div>
   </form>
   </section>
   {% endif %}


<section class="posts-container" style="padding-bottom: 0;">

   <div class="box-container">
      {% if post %}
      <form class="box" method="post">
         {% csrf_token %}
         <input type="hidden" name="post_id" value="{{ post.id }}">
         <input type="hidden" name="admin_id" value="{{ post.admin_id }}">
         <div class="post-admin">
            <i class="fas fa-user"></i>
            <div>
               <a href="{% url 'author_posts' author=post.name %}">{{ post.name }}</a>
               <div>{{ post.date }}</div>
            </div>
         </div>
         
         {% if post.image %}
         <img src="{{ post.image.url }}" class="post-image" alt="">
         {% endif %}
         <div class="post-title">{{ post.title }}</div>
         <div class="post-content">{{ post.content }}</div>
         <div class="icons">
            <div><i class="fas fa-comment"></i><span>({{ total_post_comments }})</span></div>
            <button type="submit" name="like_post"><i class="fas fa-heart" style="{% if user_liked %}color:red;{% endif %}"></i><span>({{ total_post_likes }})</span></button>
         </div>
      
      </form>
      {% else %}
         <p class="empty">No posts found!</p>
      {% endif %}
   </div>

</section>

<section class="comments-container">
   <p class="comment-title">Add comment</p>
   {% if user_id %}
   <form action="" method="post" class="add-comment">
      {% csrf_token %}
      <input type="hidden" name="admin_id" value="{{ post.admin_id }}">
      <input type="hidden" name="user_name" value="{{ user_name }}">
      <p class="user"><i class="fas fa-user"></i><a href="{% url 'update_profile' %}">{{ user_name }}</a></p>
      <textarea name="comment" maxlength="1000" class="comment-box" cols="30" rows="10" placeholder="Write your comment..." required></textarea>
      <input type="submit" value="add comment" class="inline-btn" name="add_comment">
   </form>
   {% else %}
   <div class="add-comment">
      <p>Please login to add or edit your comment</p>
      <a href="{% url 'login' %}" class="inline-btn">Login</a>
   </div>
   {% endif %}
   
   <p class="comment-title">Post comments</p>
   <div class="user-comments-container">
      {% if all_comments %}
         {% for comment in all_comments %}
            <div class="show-comments" style="{% if comment.user_id.id == user_id %}order:-1;{% endif %}">
               <div class="comment-user">
                  <i class="fas fa-user"></i>
                  <div>
                     <span>{{ comment.user_name }}</span>
                     <div>{{ comment.date }}</div>
                  </div>
               </div>
               <div class="comment-box" style="{% if comment.user_id.id == user_id %}color:var(--black); background:var(--light-bg); {% endif %}">{{ comment.comment }}</div>
               {% if comment.user_id.id == user_id %}
                  <form action="" method="POST">
                     {% csrf_token %}
                     <input type="hidden" name="comment_id" value="{{ comment.id }}">
                     <button type="submit" class="inline-option-btn" name="open_edit_box">Edit comment</button>
                     <button type="submit" class="inline-delete-btn" name="delete_comment" onclick="return confirm('Delete this comment?');">Delete comment</button>
                  </form>
               {% endif %}
            </div>
         {% endfor %}
      {% else %}
         <p class="empty">No comments added yet!</p>
      {% endif %}
   </div>

</section>
{% include 'footer.html' %}

<script src="{% static 'js/script.js' %}"></script>

</body>
</html>